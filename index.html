<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>AstroPose v16 - World Globe</title>
    <style>
        /* --- CSS GLOBAL --- */
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Roboto, sans-serif; color: #fff; }

        /* V√çDEO E CANVAS */
        #input_video {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            object-fit: cover; transform: scaleX(-1); z-index: 0;
            opacity: 0.3; filter: contrast(1.1) grayscale(0.6);
        }
        #output_canvas { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none; }
        #skeleton_canvas { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2; pointer-events: none; transform: scaleX(-1); }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 3; pointer-events: none; }

        /* LOGO */
        .logo {
            position: absolute; top: 20px; left: 20px; font-size: 24px; font-weight: 800; letter-spacing: 2px;
            background: linear-gradient(90deg, #00f2fe, #4facfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 242, 254, 0.5);
        }

        /* SUM√ÅRIO VERTICAL */
        #controls-summary {
            position: absolute; top: 80px; left: 20px; width: 160px;
            background: rgba(0, 15, 30, 0.8); border: 1px solid rgba(0, 242, 254, 0.3);
            border-radius: 8px; padding: 15px;
            display: flex; flex-direction: column; gap: 15px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(0, 242, 254, 0.1);
        }
        .control-header { font-size: 10px; color: #00f2fe; border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 5px; letter-spacing: 1px; }
        .control-item { display: flex; align-items: center; gap: 10px; font-size: 12px; color: #ccc; text-align: left; }
        .control-icon { font-size: 20px; width: 25px; text-align: center; color: #fff; }
        .key-desc { opacity: 0.8; }

        /* CHAT CONTAINER */
        #chat-container {
            position: absolute; bottom: 20px; left: 20px; width: 340px; height: 300px;
            background: rgba(0, 10, 20, 0.9);
            border: 1px solid #00f2fe;
            border-radius: 12px;
            display: flex; flex-direction: column;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 242, 254, 0.15);
            overflow: hidden;
        }

        /* CABE√áALHO DO CHAT */
        #chat-header {
            padding: 12px 15px;
            background: rgba(0, 242, 254, 0.15);
            border-bottom: 1px solid rgba(0, 242, 254, 0.3);
            color: #00f2fe;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-transform: uppercase;
        }

        #chat-history {
            flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 12px;
        }
        #chat-history::-webkit-scrollbar { width: 4px; }
        #chat-history::-webkit-scrollbar-thumb { background: #00f2fe; border-radius: 2px; }

        /* BAL√ïES DE MENSAGEM */
        .msg {
            padding: 10px 12px; border-radius: 8px; max-width: 85%; word-wrap: break-word; line-height: 1.4;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        .msg-ai {
            background: rgba(0, 242, 254, 0.1); color: #e0ffff; align-self: flex-start;
            border-left: 3px solid #00f2fe;
        }
        .msg-user {
            background: rgba(255, 255, 255, 0.15); color: #fff; align-self: flex-end;
            text-align: right; border-right: 3px solid #aaa;
        }
        .msg-error { background: rgba(255, 50, 50, 0.2); color: #ffaaaa; align-self: flex-start; border-left: 3px solid red; }

        /* ANIMA√á√ÉO DE DIGITANDO */
        .typing-indicator { display: flex; align-items: center; gap: 3px; padding: 12px 15px; }
        .typing-dot { width: 6px; height: 6px; background-color: #00f2fe; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* INPUT AREA */
        #chat-input-area { display: flex; border-top: 1px solid rgba(0, 242, 254, 0.3); padding: 5px; background: rgba(0,0,0,0.3); }
        #chat-input { flex: 1; background: transparent; border: none; padding: 10px; color: #fff; outline: none; font-family: inherit; }
        #chat-send { background: transparent; border: none; color: #00f2fe; padding: 0 15px; cursor: pointer; transition: transform 0.2s; font-size: 18px; }
        #chat-send:hover { transform: scale(1.2); }

        /* INFO PANEL */
        #info-panel {
            position: absolute; right: 30px; top: 50%; transform: translateY(-50%);
            width: 280px; background: rgba(0, 0, 0, 0.85); border-right: 4px solid #00f2fe;
            padding: 20px; border-radius: 10px 0 0 10px; text-align: right;
            display: none;
        }
        #info-panel.active { display: block; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity:0; transform: translate(50px, -50%); } to { opacity:1; transform: translate(0, -50%); } }
        .info-title { font-size: 24px; color: #00f2fe; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .info-coord { font-family: monospace; font-size: 11px; color: #888; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .info-desc { font-size: 13px; color: #ccc; line-height: 1.4; }

        /* MIRA CENTRAL */
        #crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; border: 1px dashed rgba(255, 255, 255, 0.3); border-radius: 50%;
            pointer-events: none; transition: 0.3s;
        }
        .scanning #crosshair { border-color: #00f2fe; box-shadow: 0 0 15px #00f2fe; transform: translate(-50%, -50%) scale(1.2); }
        #gps-data { position: absolute; top: 50%; left: 50%; transform: translate(-50%, 40px); text-align: center; font-family: monospace; font-size: 10px; color: #00f2fe; opacity: 0.7; }

        /* LOADING */
        #loading { position: absolute; inset: 0; background: #000; z-index: 99; display: flex; align-items: center; justify-content: center; color: #00f2fe; }

        /* MODE INDICATOR */
        .mode-indicator { position: absolute; top: 20px; right: 20px; font-size: 12px; font-weight: bold; background: rgba(0, 0, 0, 0.6); padding: 8px 15px; border-radius: 4px; color: #fff; border: 1px solid #333; }
    </style>
</head>
<body>
    <div id="loading">INICIANDO ASTROPOSE V16...</div>

    <video id="input_video" playsinline></video>
    <canvas id="output_canvas"></canvas>
    <canvas id="skeleton_canvas"></canvas>

    <div id="ui-layer">
        <div class="logo">ASTROPOSE V16</div>
        <div class="mode-indicator">SISTEMA: <span id="current-mode" style="color: #00f2fe;">AGUARDANDO</span></div>
        <div id="crosshair"></div>
        <div id="gps-data">LAT: 0.00 | LON: 0.00</div>

        <div id="controls-summary">
            <div class="control-header">CONTROLES</div>
            <div class="control-item"><span class="control-icon">‚úä</span><span class="key-desc">MOVER</span></div>
            <div class="control-item"><span class="control-icon">‚úã</span><span class="key-desc">ESCANEAR</span></div>
            <div class="control-item"><span class="control-icon">‚úåÔ∏è</span><span class="key-desc">ZOOM (+)</span></div>
            <div class="control-item"><span class="control-icon">ü§è</span><span class="key-desc">ZOOM (-)</span></div>
        </div>

        <div id="info-panel">
            <div class="info-title" id="geo-name">--</div>
            <div class="info-coord" id="geo-coord">--</div>
            <div class="info-desc" id="geo-details">--</div>
        </div>

        <div id="chat-container">
            <div id="chat-header">
                <span>AstroPoseAI - Gemini</span>
                <span style="font-size: 10px; color: lime;">‚óè ONLINE</span>
            </div>
            <div id="chat-history">
                <div class="msg msg-ai">Conex√£o estabelecida. Estou pronto para responder suas perguntas.</div>
            </div>
            <div id="chat-input-area">
                <input type="text" id="chat-input" placeholder="Digite sua pergunta..." autocomplete="off">
                <button id="chat-send">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Mediapipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        // --- API GEMINI ---
        const API_KEY = "COLOQUE_SUA_API_KEY_DO_GEMINI_AQUI";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;

        // Banco din√¢mico de pa√≠ses (preenchido pelo GeoJSON)
        const COUNTRY_DB = [];

        // --- DOM ---
        const loadingScreen = document.getElementById('loading');
        const gpsData = document.getElementById('gps-data');
        const infoPanel = document.getElementById('info-panel');
        const uiLayer = document.getElementById('ui-layer');

        // --- THREE.JS SETUP ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 11;

        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('output_canvas'), alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        const earthGroup = new THREE.Group();
        scene.add(earthGroup);

        // GLOBO
        const texLoader = new THREE.TextureLoader();
        const earth = new THREE.Mesh(
            new THREE.SphereGeometry(1.8, 64, 64),
            new THREE.MeshPhongMaterial({
                map: texLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg'),
                bumpMap: texLoader.load('https://unpkg.com/three-globe/example/img/earth-topology.png'),
                bumpScale: 0.05,
                specular: new THREE.Color(0x222222),
                shininess: 12
            })
        );
        earthGroup.add(earth);

        const clouds = new THREE.Mesh(
            new THREE.SphereGeometry(1.82, 64, 64),
            new THREE.MeshPhongMaterial({
                map: texLoader.load('https://unpkg.com/three-globe/example/img/earth-clouds.png'),
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending,
                side: THREE.DoubleSide
            })
        );
        earthGroup.add(clouds);

        const atmo = new THREE.Mesh(
            new THREE.SphereGeometry(2.0, 64, 64),
            new THREE.MeshBasicMaterial({ color: 0x00f2fe, transparent: true, opacity: 0.1, side: THREE.BackSide })
        );
        earthGroup.add(atmo);

        // PIN TARGET (para o pa√≠s selecionado)
        const targetGeo = new THREE.RingGeometry(0.05, 0.08, 32);
        const targetMat = new THREE.MeshBasicMaterial({ color: 0xff0000, side: THREE.DoubleSide, transparent: true, opacity: 0.8, depthTest: false });
        const targetMarker = new THREE.Mesh(targetGeo, targetMat);
        targetMarker.renderOrder = 999;
        targetMarker.visible = false;
        earth.add(targetMarker);

        // SPRITES DE LABEL
        const LABEL_SCALE = 0.07;

        function createLabelSprite(text) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 128;
            canvas.height = 64;
            ctx.font = 'bold 22px "Segoe UI", Roboto, sans-serif';
            ctx.fillStyle = 'rgba(0, 242, 254, 1.0)';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = 'rgba(0, 242, 254, 0.8)';
            ctx.shadowBlur = 8;
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({
                map: texture,
                transparent: true,
                opacity: 0.8,
                depthWrite: false
            });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(LABEL_SCALE, LABEL_SCALE * 0.45, 1);
            return sprite;
        }

        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);
            const x = -(radius * Math.sin(phi) * Math.cos(theta));
            const z = (radius * Math.sin(phi) * Math.sin(theta));
            const y = (radius * Math.cos(phi));
            return new THREE.Vector3(x, y, z);
        }

        // Luzes
        const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
        sunLight.position.set(5, 3, 8);
        scene.add(sunLight);
        scene.add(new THREE.AmbientLight(0x111111));

        // --- CARREGAR TODOS OS PA√çSES (GeoJSON) ---
        async function loadWorldGeoJSON() {
            try {
                const res = await fetch("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson");
                const geojson = await res.json();
                buildWorldFromGeoJSON(geojson);
            } catch (err) {
                console.error("Erro ao carregar GeoJSON do mundo:", err);
            }
        }

        function buildWorldFromGeoJSON(geojson) {
            const borderMaterial = new THREE.LineBasicMaterial({
                color: 0x00f2fe,
                transparent: true,
                opacity: 0.25,
                linewidth: 1
            });

            geojson.features.forEach(feat => {
                if (!feat.geometry) return;
                const props = feat.properties || {};
                const name = (props.name || props.admin || "Pa√≠s").toString();
                const iso3 = (props.iso_a3 || props.iso3 || "").toString();
                const geom = feat.geometry;
                const allCoords = [];

                function processRing(ring) {
                    const vertices = [];
                    ring.forEach(coord => {
                        const lon = coord[0];
                        const lat = coord[1];
                        allCoords.push({ lat, lon });
                        const v = latLonToVector3(lat, lon, 1.83);
                        vertices.push(v.x, v.y, v.z);
                    });
                    if (vertices.length >= 6) {
                        const g = new THREE.BufferGeometry();
                        g.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                        const line = new THREE.Line(g, borderMaterial);
                        earthGroup.add(line);
                    }
                }

                if (geom.type === "Polygon") {
                    geom.coordinates.forEach(ring => processRing(ring));
                } else if (geom.type === "MultiPolygon") {
                    geom.coordinates.forEach(poly => {
                        poly.forEach(ring => processRing(ring));
                    });
                }

                if (allCoords.length > 0) {
                    let sumLat = 0, sumLon = 0;
                    allCoords.forEach(c => {
                        sumLat += c.lat;
                        sumLon += c.lon;
                    });
                    const centerLat = sumLat / allCoords.length;
                    const centerLon = sumLon / allCoords.length;
                    const labelText = (iso3 && iso3 !== "-99") ? iso3.toUpperCase() : name.toUpperCase();
                    const label = createLabelSprite(labelText);
                    const pos = latLonToVector3(centerLat, centerLon, 1.90);
                    label.position.copy(pos);
                    earthGroup.add(label);
                    COUNTRY_DB.push({
                        name: name.toUpperCase(),
                        short: labelText,
                        lat: centerLat,
                        lon: centerLon,
                        desc: `Pa√≠s: ${name}`
                    });
                }
            });

            console.log("Pa√≠ses carregados:", COUNTRY_DB.length);
        }

        // --- L√ìGICA DE ROta√ß√£o / ZOOM / ESCANEAMENTO ---
        let isGrabbing = false;
        let lastHandPos = { x: 0, y: 0 };
        let targetScale = 1;
        let rotY = 4.7;
        let rotX = 0.2;
        let isScanning = false;
        const ROTATION_SPEED = 0.003;

        function getCoordinatesFromRotation(rY, rX) {
            let lon = -((rY % (Math.PI * 2)) / Math.PI) * 180;
            lon = (lon % 360);
            if (lon > 180) lon -= 360;
            if (lon < -180) lon += 360;
            lon -= 90;
            if (lon < -180) lon += 360;
            let lat = (rX / (Math.PI / 2)) * 90;
            return { lat: lat, lon: lon };
        }

        function findNearestLocation(lat, lon) {
            if (!COUNTRY_DB.length) return null;
            let closest = null;
            let minDist = 10000;
            COUNTRY_DB.forEach(loc => {
                const dLat = loc.lat - lat;
                const dLon = loc.lon - lon;
                const dist = Math.sqrt(dLat * dLat + dLon * dLon);
                if (dist < minDist) {
                    minDist = dist;
                    closest = loc;
                }
            });
            return minDist < 20 ? closest : null;
        }

        // --- MEDIAPIPE M√ÉOS ---
        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.6 });
        const skeletonCanvasEl = document.getElementById('skeleton_canvas');
        const sCtx = skeletonCanvasEl.getContext('2d');
        skeletonCanvasEl.width = window.innerWidth;
        skeletonCanvasEl.height = window.innerHeight;

        hands.onResults((results) => {
            loadingScreen.style.display = 'none';
            sCtx.clearRect(0, 0, skeletonCanvasEl.width, skeletonCanvasEl.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                const hX = (1 - lm[9].x) * window.innerWidth;
                const hY = lm[9].y * window.innerHeight;
                const handSize = Math.hypot(lm[9].x - lm[0].x, lm[9].y - lm[0].y);
                const isFist = (Math.hypot(lm[12].x - lm[0].x, lm[12].y - lm[0].y) / handSize) < 0.85;
                const pinchDist = Math.hypot(lm[4].x - lm[8].x, lm[4].y - lm[8].y) / handSize;

                if (isFist) {
                    document.getElementById('current-mode').innerText = "MOVER (PUNHO)";
                    document.getElementById('current-mode').style.color = "yellow";
                    uiLayer.classList.remove('scanning');
                    isScanning = false;
                    if (!isGrabbing) {
                        isGrabbing = true;
                        lastHandPos = { x: hX, y: hY };
                    } else {
                        rotY += (hX - lastHandPos.x) * ROTATION_SPEED;
                        rotX += (hY - lastHandPos.y) * ROTATION_SPEED;
                        lastHandPos = { x: hX, y: hY };
                    }
                } else if (pinchDist < 0.3 || pinchDist > 0.7) {
                    isGrabbing = false;
                    isScanning = false;
                    uiLayer.classList.remove('scanning');
                    if (pinchDist < 0.3) {
                        targetScale = Math.max(0.8, targetScale - 0.05);
                        document.getElementById('current-mode').innerText = "ZOOM - (PIN√áA)";
                    } else {
                        targetScale = Math.min(3.5, targetScale + 0.05);
                        document.getElementById('current-mode').innerText = "ZOOM + (ABERTO)";
                    }
                    document.getElementById('current-mode').style.color = "orange";
                } else {
                    isGrabbing = false;
                    document.getElementById('current-mode').innerText = "ESCANEAR";
                    document.getElementById('current-mode').style.color = "#00f2fe";
                    uiLayer.classList.add('scanning');
                    isScanning = true;
                }
            } else {
                uiLayer.classList.remove('scanning');
                isScanning = false;
                document.getElementById('current-mode').innerText = "AGUARDANDO";
                document.getElementById('current-mode').style.color = "#fff";
            }
        });

        // --- CHAT (com anima√ß√£o de digitando) ---
        const cIn = document.getElementById('chat-input');
        const cBtn = document.getElementById('chat-send');
        const cHist = document.getElementById('chat-history');

        async function askAI(q) {
            if (!q) return;

            const userMsg = document.createElement('div');
            userMsg.className = 'msg msg-user';
            userMsg.innerText = q;
            cHist.appendChild(userMsg);
            cIn.value = '';
            cHist.scrollTop = cHist.scrollHeight;

            const typingBubble = document.createElement('div');
            typingBubble.className = 'msg msg-ai typing-indicator';
            typingBubble.id = 'ai-typing';
            typingBubble.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
            cHist.appendChild(typingBubble);
            cHist.scrollTop = cHist.scrollHeight;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: `Modo IA Sci-Fi do sistema AstroPose. Resuma de forma curta e direta. Pergunta: ${q}` }]
                        }]
                    })
                });
                const data = await res.json();
                const typingEl = document.getElementById('ai-typing');
                if (typingEl) typingEl.remove();

                if (!data.candidates || !data.candidates[0].content) {
                    throw new Error("Sem resposta");
                }

                const ans = document.createElement('div');
                ans.className = 'msg msg-ai';
                ans.innerText = data.candidates[0].content.parts[0].text.replace(/\*/g, '');
                cHist.appendChild(ans);
            } catch (e) {
                const typingEl = document.getElementById('ai-typing');
                if (typingEl) typingEl.remove();
                const err = document.createElement('div');
                err.className = 'msg msg-error';
                err.innerText = "Erro de conex√£o com Gemini.";
                cHist.appendChild(err);
            }
            cHist.scrollTop = cHist.scrollHeight;
        }

        cBtn.onclick = () => askAI(cIn.value);
        cIn.addEventListener("keypress", (e) => { if (e.key === "Enter") cBtn.click(); });

        // --- LOOP DE ANIMA√á√ÉO ---
        function animate() {
            requestAnimationFrame(animate);

            earthGroup.rotation.y += (rotY - earthGroup.rotation.y) * 0.1;
            earthGroup.rotation.x += (rotX - earthGroup.rotation.x) * 0.1;
            earthGroup.rotation.x = Math.max(-1.0, Math.min(1.0, earthGroup.rotation.x));

            const currentScale = earthGroup.scale.x || 1;
            const newScale = currentScale + (targetScale - currentScale) * 0.1;
            earthGroup.scale.set(newScale, newScale, newScale);

            clouds.rotation.y += 0.0002;

            const coords = getCoordinatesFromRotation(earthGroup.rotation.y, earthGroup.rotation.x);
            gpsData.innerText = `LAT: ${coords.lat.toFixed(1)} | LON: ${coords.lon.toFixed(1)}`;

            if (isScanning) {
                const loc = findNearestLocation(coords.lat, coords.lon);
                if (loc) {
                    infoPanel.classList.add('active');
                    document.getElementById('geo-name').innerText = loc.name;
                    document.getElementById('geo-coord').innerText = `${coords.lat.toFixed(1)}¬∞, ${coords.lon.toFixed(1)}¬∞`;
                    document.getElementById('geo-details').innerText = loc.desc || "Informa√ß√µes indispon√≠veis.";
                    targetMarker.visible = true;
                    const pos = latLonToVector3(loc.lat, loc.lon, 1.81);
                    targetMarker.position.copy(pos);
                    targetMarker.lookAt(0, 0, 0);
                } else {
                    infoPanel.classList.remove('active');
                    targetMarker.visible = false;
                }
            } else {
                targetMarker.visible = false;
            }

            renderer.render(scene, camera);
        }

        // --- C√ÇMERA (WEB) ---
        const cam = new Camera(document.getElementById('input_video'), {
            onFrame: async () => {
                await hands.send({ image: document.getElementById('input_video') });
            },
            width: 1280,
            height: 720
        });
        cam.start();

        // --- RESIZE ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            skeletonCanvasEl.width = window.innerWidth;
            skeletonCanvasEl.height = window.innerHeight;
        });

        // Inicia tudo
        loadWorldGeoJSON();
        animate();
    </script>
</body>
</html>
